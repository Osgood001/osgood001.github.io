---
title: "Agent"
date: 2023-11-14
tags: [Programming, Agent]
---

# Agent: A General Problem Solver
<!-- # Use AI Agent to Complete My Homework -->
<!-- > Cognitive Computing Seminar@2023.11.23 -->
<!-- > PhD English Oral Test@2023.12.18 -->
<!-- > -->
> Shigang Ou 欧仕刚
> 
> Theoretical Physics, Institute Of Physics, CAS
<!-- > ID: 202318000807066 -->

> 普罗米修斯把一根芦苇伸向太阳，太阳点燃了芦苇秆中干燥柔软的绒髓。 火星在绒髓中缓慢燃烧，普罗米修斯通过这根烧着的芦苇秆将火种带到人间。
>
> Prometheus brought fire to mankind by lighting a reed from the sun. (*Greek Mythology*)

## Advanced Quantum Mechanics v.s. ChatGPT

- Abstract, advanced math techniques

![image](https://static.docsity.com/documents_first_pages/2012/07/19/10019d9d7716560cc15e7884171696e4.png?v=1638158234)

- Make factual mistakes

![Image](https://pic4.zhimg.com/80/v2-b599954a8187902dcd577c661b5e6f66.png)

Who will win ?

## History of Cognitive Computing 

- 1950s: Turing Test
- 1956: Logic Theorist
- 1959: General Problem Solver
- 2006: Neuralsynaptic chips
- 2011: IBM Watson achieved 80% accuracy in Jeopardy (a quiz show)
- 2022: OpenAI ChatGPT, LLMs.
- 2023: Create an Agent to complete my **Advanced Quantum Mechanics assignments**.

## Symbolic AI

- Newell A proposed the SOAR(Shor-term memory, Operator, And, Result) model. It's a symbol processing model. It's a **general problem solver**. It can solve problems like Tower of Hanoi, Missionaries and Cannibals, etc. It is only short-memory.

- Anderson J proposed the ACT-R(Adaptive Control of Thought-Rational) It. Which is a long-term memory model.

## Agent, or Embodied Cognition

- 2002: NSF, DOC, DARPA funded cognitive computing research, be able to **think towards enviroment**, target and own ability. It has learning ability and can interact with human, explain its reasoning, and cope with sudden events.

- Enactivism: Human brain is not a passive processor, but an **active agent**. It interacts with the environment and learns from it. Instead of just focusing on representation and reasoning, it also focuses on interaction and learning with the environment.

- **Brooks** written articles like "Intelligence without representation" and "Intelligence without reason". He proposed the concept of "Embodied Cognition". (具身认知) He developed an **artificial insect**, which can avoid obstacles and find food. (It's a very simple insect, but it's a milestone.)

> LeCun stated that before we create intelligence of an insect, we cannot create intelligence of a human.

> Simple agent could combine to create complex behavior. (Emergent behavior)

## What is Agent

[Lil's blog](https://lilianweng.github.io/posts/2023-06-23-agent/)中对Agent的评价是：

> The potentiality of LLM extends beyond generating well-written copies, stories, essays and programs; it can be framed as a powerful general problem solver.
>
> LLM的潜力不仅限于生成写得好的副本、故事、论文和程序；它可以被构建成一个强大的**通用问题求解器**。

![Image](https://pic4.zhimg.com/80/v2-a80b27c7a14513ea9bef27704ab274e3.png)

它具有如下能力：

- 使用工具：通过API接口理论上可以使用任何工具
- 记忆：短期、长期记忆
- 规划：反思、自我评判、思维链条、子目标分解
- 行动：基于记忆进行规划，然后用工具执行

> 很大程度上，人类就是这样的一个机器。如今，我们接近于掌握了神创造人的能力，OpenAI是这个时代的普罗米修斯。

## Proof of Concept

通过了解 AutoGPT, GPT-Engineer, BabyAGI，可以对Agent的构造使用有一定的理解。

## 稳定可用的自动化Agent构建渠道
## How to Build an Agent

ChatGPT Pro: 20$/month

[OpenGPTs](https://github.com/langchain-ai/opengpts) 是替代OpenAI GPTs的一个开源方案，定制化程度高，工具也很多，仅仅是配置麻烦，需要一定的技术能力和时间，稳定性一般（需要self-host）

[OpenAI GPTs](www.openai.com/blog/openai-api/) 是一个稳定可用的自动化Agent构建渠道，目前尚不能知道能否稳定访问，可以基于API_key来使用，从这点来说，它是一个稳定可用的自动化Agent构建渠道。

综上，使用OpenAI GPTs 的API_key来构建Agent是一个可行的方案。

## Details of Building

按照[OpenAI Dev Platform](https://community.openai.com/t/build-your-own-ai-assistant-in-10-lines-of-code-python/83210)老哥的建议，结合最新的[API文档](https://platform.openai.com/docs/api-reference)，走通了一个可以在命令行环境运行的Agent，截至2023-11-16 10:08:46，可以在最新的openai pakage环境正常运行。

```python
from openai import OpenAI

client = OpenAI(api_key="XXX") # supply your API key however you choose

message = {"role":"user", "content": input("This is the beginning of your chat with AI. [To exit, send \"###\".]\n\nYou:")}

conversation = [{"role": "system", "content": "DIRECTIVE_FOR_gpt-3.5-turbo"}]

while(message["content"]!="###"):
    conversation.append(message)
    completion = client.chat.completions.create(model="gpt-3.5-turbo", messages=conversation) 
    message["content"] = input(f"Assistant: {completion.choices[0].message.content} \nYou:")
    print()
    conversation.append(completion.choices[0].message)
```

> Python的I/O操作在这里用的是`input()`

接下来，我们按照[教程](https://platform.openai.com/docs/assistants/overview)构建一个最简单的Agent，以走通流程。

> This starter guide walks through the key steps to create and run an Assistant that uses **Code Interpreter**.

### Assistant

构建一个最简单的Agent，只需要让客户端创建一个`assistant`，然后给定指令`instructions`，模型`model`，工具`tools`，就可以了，其中内置的工具可以直接用`type`来指定。

```python
assistant = client.beta.assistants.create(
  instructions="You are a personal math tutor. When asked a math question, write and run code to answer the question.",
#   model="gpt-4-1106-preview",
  model="gpt-3.5-turbo", # use a cheaper model
  tools=[{"type": "code_interpreter"}]
)
```

> `client` ：一个OpenAI的客户端
>
> `assistant` ：一个Agent


### Thread

现在，我们构建了一个Agent，接下来，我们需要给Agent一个任务，让它去完成，工作原理如下

![Image](https://pic4.zhimg.com/80/v2-f4b0b5bce9f4cde98b9d6b84bbaa6027.png)


核心部分：

- Assistant: 给定指令，模型，工具，创建一个Agent
- Thread：聊天记录，包括用户和Agent的对话（`messages`）
- Run：运行一个Thread，让Agent完成任务

```python
# Upload a file with an "assistants" purpose
file = client.files.create(
  file=open("input.txt", "rb"),
  purpose='assistants'
)

# Create an assistant using the file ID
assistant = client.beta.assistants.create(
  instructions="You are a personal math tutor. When asked a math question, write and run code to answer the question.",
#   model="gpt-4-1106-preview",
  model="gpt-3.5-turbo", # use a cheaper model
  tools=[{"type": "code_interpreter"}],
  file_ids=[file.id]
)
```

接下来创建一个Thread，让Agent完成任务

```python
thread = client.beta.threads.create(
  messages=[
    {
      "role": "user",
      "content": "Create 3 data visualizations based on the trends in this file.",
      "file_ids": [file.id]
    }
  ]
)

# Run the assistant on the thread
run = client.beta.threads.runs.create(
  thread_id=thread.id,
  assistant_id=assistant.id
)
```

### Run

the run have many states:

![Image](https://pic4.zhimg.com/80/v2-4a40ef10d828362705cc2bae13ec4e0f.png)

If completed, new messages will be added to the thread, we can check the result by

```python
# Get the thread
thread = client.beta.threads.retrieve(thread.id)

# Print the messages
for message in thread.messages:
  print(message.content)
```

但值得注意的是，由于和服务器通讯需要时间，但这里没有提供`wait()`函数，所以直接运行只能看到被修改之前的`thread`，上面代码输出的结果是：

```python
[ThreadMessage(
    id='msg_adN5zDKj3SZsFt6FDrEGCIh9',
    assistant_id=None,
    content=[MessageContentText(
        text=Text(annotations=[], value='Create 1 data visualizations based on the trends in this file.'),
        type='text'
    )],
    created_at=1700121819,
    file_ids=['file-kwq6JAns0HrtZiCDdZi1TZle'],
    metadata={},
    object='thread.message',
    role='user',
    run_id=None,
    thread_id='thread_l39atOePQfskPzf0dMPCdwLK'
)]
```

可见这里只有一个`message`。但如果你多次运行该脚本，你仍然得到同样的输出，因为每次都会创建一个新的`assistant`，`thread`，`run`，所以我们需要在`run`完成之前，不断地检查`run`的状态，直到`run`完成，然后再检查`thread`的状态。

这里我们期待的结果是：

```python
[
    ThreadMessage(
        id='msg_jm5CCVRIOJWC5iPCh8voaSuV', 
        assistant_id='asst_Kca5bKsMgJDT2qw67x824Cbt', 
        content=[
            MessageContentImageFile(
                image_file=ImageFile(file_id='file-UGVhdJHm6onKw4MPnxWVmZHM'), 
                type='image_file'
            ), 
            MessageContentText(
                text=Text(
                    annotations=[], 
                    value='The scatter plot above shows the relationship between the two numerical columns in the data file. Each point represents a data point with the x-coordinate corresponding to the values in column 1 and the y-coordinate corresponding to the values in column 2. Without additional information about the data, it is challenging to interpret any specific trends or patterns from this visualization.\n\nIf you provide more context or specify the type of visualization you would like to see, I can assist you further.'
                ), 
                type='text'
            )
        ], 
        created_at=1700122082, 
        file_ids=[], 
        metadata={}, 
        object='thread.message', 
        role='assistant', 
        run_id='run_d0bg4GvYvzPm16UuA9BSgum9', 
        thread_id='thread_l39atOePQfskPzf0dMPCdwLK'
    ), 
    ThreadMessage(
        id='msg_XqaoSp1EnYUCfgVGmC7y62L8', 
        assistant_id='asst_Kca5bKsMgJDT2qw67x824Cbt', 
        content=[
            MessageContentText(
                text=Text(
                    annotations=[], 
                    value='Based on the data in the file, it appears that there are two numerical columns without any header information. Without knowing the context or meaning of the data, it is difficult to identify specific trends or patterns. However, I can still generate a basic visualization to provide an overview of the data.'
                ), 
                type='text'
            )
        ], 
        created_at=1700122077, 
        file_ids=[], 
        metadata={}, 
        object='thread.message', 
        role='assistant', 
        run_id='run_d0bg4GvYvzPm16UuA9BSgum9', 
        thread_id='thread_l39atOePQfskPzf0dMPCdwLK'
    ), 
    ThreadMessage(
        id='msg_Qd4RwduRtIyie0L1LP8AJ1c0', 
        assistant_id='asst_Kca5bKsMgJDT2qw67x824Cbt', 
        content=[
            MessageContentImageFile(
                image_file=ImageFile(file_id='file-6n8uPi7buOJCqomQceZtXrcu'), 
                type='image_file'
            ), 
            MessageContentText(
                text=Text(
                    annotations=[], 
                    value='The line chart above shows the relationship between the variables in the data file. Each point on the chart represents the values of the two variables for a specific data point. The chart helps visualize any trends or patterns in the data.\n\nPlease let me know if there is anything else I can help you with.'
                ), 
                type='text'
            )
        ], 
        created_at=1700121835, 
        file_ids=[], 
        metadata={}, 
        object='thread.message', 
        role='assistant', 
        run_id='run_I5WfDBDybUilwBDfsFnnPGLt', 
        thread_id='thread_l39atOePQfskPzf0dMPCdwLK'
    ), 
    ThreadMessage(
        id='msg_C5oNrcFxDfiAeoA3Y3ssv5CQ', 
        assistant_id='asst_Kca5bKsMgJDT2qw67x824Cbt', 
        content=[
            MessageContentText(
                text=Text(
                    annotations=[], 
                    value="The data file contains two columns named `-0.45963489857655115` and `-0.6802488378393142`. To create a data visualization based on the trends in this file, we can plot a line chart to show the relationship between these two variables.\n\nLet's plot the line chart using the data."
                ), 
                type='text'
            )
        ], 
        created_at=1700121829, 
        file_ids=[], 
        metadata={}, 
        object='thread.message', 
        role='assistant', 
        run_id='run_I5WfDBDybUilwBDfsFnnPGLt', 
        thread_id='thread_l39atOePQfskPzf0dMPCdwLK'
    ), 
    ThreadMessage(
        id='msg_adN5zDKj3SZsFt6FDrEGCIh9', 
        assistant_id=None, 
        content=[
            MessageContentText(
                text=Text(
                    annotations=[], 
                    value='Create 1 data visualizations based on the trends in this file.'
                ), 
                type='text'
            )
        ], 
        created_at=1700121819, 
        file_ids=['file-kwq6JAns0HrtZiCDdZi1TZle'], 
        metadata={}, 
        object='thread.message', 
        role='user', 
        run_id=None, 
        thread_id='thread_l39atOePQfskPzf0dMPCdwLK'
    )
]
```

很精彩，但是需要进一步的解析才能使用。

### Post-processing

为了下载其中的图片等文件，需要通过client读取

```python
from openai import OpenAI

client = OpenAI()

image_data = client.files.content("file-6n8uPi7buOJCqomQceZtXrcu")
image_data_bytes = image_data.read()

with open("./my-image.png", "wb") as file:
    file.write(image_data_bytes)
```

![Image](https://pic4.zhimg.com/80/v2-51a114dbb7636a2e0c238e2628b78503.png)

嗯……并不是太惊艳，比如把数值识别成了标记（而不是用x,y轴表示），但考虑到它并没有直接去挖掘数据内部的结构，只是宏观地操作，这和人的认识方式相近，到这里，我们创造了一个具有低年级本科生数据处理能力的Agent。

### User Interface

具有JSON(JavaScript Object Notation)格式的数据，让我们可以容易地将其构建为一个聊天机器人。

在[OpenAICommunity](https://community.openai.com/t/questions-about-assistant-threads/485239/5)有一位姐姐分享了自己做的[assistant chatbot](https://github.com/unnamedmistress/chatbot-ui-threads)，

![Image](https://pic4.zhimg.com/80/v2-6b035fe3bf4c43d1ee07a633f7269452.png)

> This is a early implimentation to use threads in a simple chatbot UI.

如果将这个项目部署在本地，的确**稳定可用**，但便捷性略有下降，因为需要自己搭建服务器，不过，由于API调用的自由，不需要订阅plus即可使用工具和插件，是非常好的开源方案（最终目标是： 即使openAI 断供，也能够迅速切换为其他模型）。

另外一个简单的思路是：直接用OpenAI官网提供的playground来可视化，只需要提供thread_id，可以做到让多个类型的assistant合作完成一个任务。（这相比于一个assistant来说会有优越性吗？）

## Completion of Works

![Image](https://pic4.zhimg.com/80/v2-08c58eceae73c2d2ce6d6e06fda7f365.png)

以下我们讨论一些具体任务的自动化处理，其中大多涉及到STEM科学中的推导和计算，尽管基于LLM的模型能够达到相当惊人的理解能力，但其结果的不精确性，要求我们提供更多的工具，以供其使用，我们首先向其说明：

Prompt:

> This is a thread where we'll solve a particular theoretical problems from physics science, it involves tedirous derivations and equation solving, making it impossible to use simple equation or derivation to conclude the final result. Our goal is to give a detailed and accurate solution to the problem, 
> 
> to do so, you should:
>
> 1. Read and understand the problem, what it's about, if any existing resources that might help understand the problem, provide an intrinstic understanding, and if possible, connect it to real world problems, and provide a textbook related computation demo or example.
>
> 2. Based on your understanding, hypothesize possible knowledge and tools that might be used to solve the problem, the tools we can use here includes:
>
>  - Mathematica
>  - Python
>  - Wolfram Alpha
>  - search engine
>
> 3. Plan the solution process ahead before actually doing it, the process should have relatively clear statement of what needed, what will be derived, and what to expect.
>
> 4. The session will terminate when the user reply with `QED`, before that, try to make this process interactive, i.e. ask for necessary input and suggestions from the user before proceeding to the next step. 
> 
> 5. When terminate, restate the solution


按照这个方案，能实现一定的功能，并在`GPT-3.5-turbo`上进行了测试。

类似的，我们构建用于解决DFT问题的Agent，其Prompt如下：

> This is a thread where we'll solve a particular theoretical problems from physics science, especially Density Functional Theory, it involves detailed understanding of various aspect of DFT, and requires derivation, computation and theoretical proof of problems.
>
> You should:
>
> 1. Read and understand the problem, what it's about, if any existing resources that might help understand the problem, provide an intrinstic understanding, and if possible, connect it to real world problems, and provide a textbook related computation demo or example.
>
> 2. Based on your understanding, hypothesize possible knowledge and tools that might be used to solve the problem, the tools we can use here includes: mathematica, python, wolfram alpha, search engine
>
> 3. Plan the solution process ahead before actually doing it, the process should have relatively clear statement of what needed, what will be derived, and what to expect.
>
> 4. Output should be bracketed in a markdown code block, and the equations should be bracketed by \$, i.e. $E=mc^2$ or $$E=mc^2$$. Use color to highlight important parts of the equation if necessary.

> To ensure the quality of the solution, the process is **interactive**, i.e. ask for necessary input and suggestions from the user before proceeding to the next step.

> But all I did is saying "Yes" and repeat the prompts one by one.

## Results

(No Internet Access)

![Image](https://pic4.zhimg.com/80/v2-f39463e864bdd0146f6ad084fadd92a3.png)

### Pros

- Graded: 9/10

![Image](https://pic4.zhimg.com/80/v2-c7fd650b6bf0b2b43682300f59c32205.png)

### Cons

Hallucination & Don't always follow the instructions

![Image](https://pic4.zhimg.com/80/v2-93939ebf58efd8f3af7be2ccfbc5f4c1.png)

## Future Work

- Embedding Textbook and related resources into the Agent
- Leveraging the power of LLM + Mathematica and tools like lean.
- Auto Theorem Proving with LLM as inspiration (开放的逻辑)

### Free all physics students from tedious derivations and computation


## References

- [OpenAI Dev Platform](https://community.openai.com/t/build-your-own-ai-assistant-in-10-lines-of-code-python/83210)
- [OpenAI API](https://platform.openai.com/docs/api-reference)
- Modern Quantum Mechanics, J.J. Sakurai, 2nd Edition, 1994, Addison-Wesley Publishing Company

